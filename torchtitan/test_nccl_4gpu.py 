import os, torch, torch.distributed as dist

def main():
    dist.init_process_group("nccl")
    rank = dist.get_rank()
    world_size = dist.get_world_size()
    torch.cuda.set_device(rank)
    x = torch.ones(1, device="cuda") * (rank + 1)
    dist.all_reduce(x)
    print(f"rank {rank}/{world_size}: x={x.item()}")
    dist.destroy_process_group()

if __name__ == "__main__":
    main()
